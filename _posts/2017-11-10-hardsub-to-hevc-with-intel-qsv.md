---
layout: post
title: ฝังซับไตเติ้ลลงวิดีโอ ด้วยพลังอันซ่อนเร้นของ Intel Quick Sync Video
date: '2017-11-10T00:17:00.000+07:00'
author: Pakkapon Phongthawee
tags:
- คอมพิวเตอร์
modified_time: '2017-11-10T00:17:00.000+07:00'
thumbnail: /assets/images/thumbnail/hardsub-to-hevc-with-intel-qsv.jpg
---
ปัจจุบันนี้มีอุปกรณ์รองรับมาตราฐานวิดีโอ H.265 หรือ HEVC ([High Efficiency Video Coding](https://en.wikipedia.org/wiki/High_Efficiency_Video_Coding)) มากขึ้น ทำให้ผมเองต้องเริ่มปรับเปลี่ยนมาใช้ไฟล์วิดีโอที่เป็น HEVC เหมือนกัน แต่ชีวิตกับไม่ราบลื่นขนาดนั้น เมื่อคอมพิวเตอร์โน้ตบุ๊คที่ผมใช้อยู่ [ASUS ROG GL552VW](https://www.asus.com/us/ROG-Republic-Of-Gamers/ROG-GL552VW/) ใช้การ์ดจอ Nvidia GTX 960M กลับไม่รองรับ HEVC เสียอย่างนั้น ทำให้หากจะต้องทำการฝังซับเป็น HEVC จะต้องใช้ซอร์ฟแวร์ซึ่งรันอยู่บน CPU ในการประมวลผลซึ่งทำให้ประมวลผลได้ช้ามาก แต่ความหวังของผมก็ไม่ถึงกับดับวูบลงเสียทีเดียว เมื่อผมพบว่าเครื่องที่ผมใช้อยู่เป็น Intel I7-6700 ซึ่งสามารถใช้ Intel QuickSync เพื่อทำการประมวลผลวิดีโอด้วยฮาร์ดแวร์ได้ และทำได้ไวกว่าแบบซอร์ฟแวร์มาก ผมจึงจะพาทุกท่านไปฝังซับโดยใช้ Intel QuickSync ไปด้วยกัน

## FFMPEG มีปัญหา
ในช่วงแรกผมได้ลองใช้ ffmpeg ในการฝังซับ แต่พบว่ามันมีปัญหาเป็นอย่างมาก เมื่อรันบางครั้งจะเจอปัญหา error -17 ซึ่งก็ไม่รู้เหมือนกันว่าเกิดขึ้นได้อย่างไร เมื่อเอาคำว่า Intel QuickSync error -17 ไปหาใน Google ก็พบว่ามีคนพบปัญหาเดียวกันเป็นจำนวนมาก ทำให้ความหวังของผมที่จะใช้ ฮาร์ดแวร์มาฝังซับแทบดับสลายในทันใด แต่ทว่า ในความสิ้นหวัง ก็ยังมีความหวังอยู่ เมื่อ Handbrake ได้ทำการแก้ปัญหา Error -17 ไปในเวอร์ชั่น 1.0.3 นี่จึงเป็นครั้งแรกที่ผมจะใช้ Handbrake ในการฝังซับ

## Handbrake ฝังซับด้วย Intel QuickSync
โดยทั่วไปแล้ว ผมจะทำซับไตเติ้ลเป็นไฟล์ ASS แต่ว่าตัว Handbrake นั้นมันดันไม่มีปุ่มเลือก ASS สำหรับมาใช้ในการฝังซับสามารถใช้ได้แค่เพียง SRT แต่มันก็มีเทคนิคเล็กๆ ในการจะฝังซับไตเติ้ลนั้น โดยการรวมไฟล์วิดีโอเข้ากับซับไตเติ้ลให้ออกมาเป็น MKV เสียก่อน

### การรวมไฟล์วิดีโอด้วย MKVToolnix

ให้เราเปิดวิดีโอ MKVToolnix GUI ขึ้นมาพร้อมกับลากไฟล์วิดีโอของเราไปใส่จากนั้นให้เลือกซับของเราใส่เข้าไป หากมีซับเดิมอยู่ให้ทำการปิดซับเดิมออก แล้วกด Start Multiplexing ได้เลย

![](/assets/images/post/hardsub-to-hevc-with-intel-qsv/mkvtoolnix.jpg)

### ตั้งค่า Handbrake

เมื่อเปิดโปรแกรม Handbrake และเลือกไฟล์ MKV ที่ เข้ามาแล้ว จากนั้นเราจะทำการเลือกซับที่จะทำการฝังโดยเลือกแท็บ Subtitles แล้วเลือก Thai (หรือหากไม่ได้ตั้งไว้ก็น่าจะขึ้นเป็น Undetermined) แล้วติ๊กถูกว่า Burn in เพื่อทำการฝังซับ

![](/assets/images/post/hardsub-to-hevc-with-intel-qsv/select-thai-ssa.jpg)

ถัดไปมาที่แท็บ Video ให้ทำการเลือก H.265 (Intel QSV) เพื่อใช้งาน Intel QuickSync ในการฝังซับ และแนะนำให้ตั้ง Constant Quality เพื่อปรับคุณภาพของไฟล์วิดีโอที่จะสร้างขึ้นมา

![](/assets/images/post/hardsub-to-hevc-with-intel-qsv/select-h265-qsv.jpg)

จากนั้นทำการกดปุ่ม Start Encode เพื่อเริ่มการฝังซับได้เลย

## เปรียบเทียบประสิทธิภาพ

จากสเปคเครื่องของผม เมื่อทำการฝังซับไฟล์วิดีโอที่ได้เห็นไปในภาพหน้าจอ หากใช้ H.265 จะได้ความเร็วเฉลี่ยที่ประมาณ **30FPS** แต่เมื่อใช้ Intel QuickSync Video จะได้ความเร็วเฉลี่ยมากถึง **75FPS** เลยทีเดียว แม้ว่า Intel QuickSync Video นั้นจะสู่เอาการ์ดจอ Nvidia ที่รองรับมา Encode ไม่ได้ แต่เครื่องผมที่การ์ดจอที่ใส่ดันไม่รองรับ H.265 ความเร็วที่มากกว่าการฝังซับแบบใช้ซอร์ฟแวร์ถึงสองเท่า ก็ถือว่าน่าประทับใจเลยทีเดียว
