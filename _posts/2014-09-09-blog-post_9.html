---
layout: post
title: "สอนเขียนแอปเฟสบุ๊คบนบล็อก : วิธีการขอสิทธิจากเฟสบุ๊คเพื่อดึงข้อมูลมาใช้ในการประมวลผล"
date: '2014-09-09T06:05:00.001+07:00'
author: Pakkapon Phongthawee
tags: 
modified_time: '2014-10-13T12:17:54.091+07:00'
thumbnail: https://3.bp.blogspot.com/-njDIrWIFiPQ/VDtgLJkDDvI/AAAAAAAASco/KjkvSAp7yg0/s72-c/Open_Graph_protocol_logo.png
blogger_id: tag:blogger.com,1999:blog-3103072889085475591.post-8088101651993998754
blogger_orig_url: http://www.pureapp.in.th/2014/09/blog-post_9.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-njDIrWIFiPQ/VDtgLJkDDvI/AAAAAAAASco/KjkvSAp7yg0/s1600/Open_Graph_protocol_logo.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-njDIrWIFiPQ/VDtgLJkDDvI/AAAAAAAASco/KjkvSAp7yg0/s1600/Open_Graph_protocol_logo.png" /></a></div>ต่อจากตอนที่แล้วครับ เมื่อเรารู้จักกับ Graph API อย่างคร่าวๆ แล้วคราวนี้เรามาลองเรียกข้อมูลกันจริงๆเลยดกว่าครับ จากตอนที่แล้วถ้าจำกันได้ เมื่อเราลองเล่น Graph Explorer เราจะเห็นว่าจะต้องมีการขอสิทธิ์ในการเข้าถึงข้อมูล ก่อนอื่นกันเลยถ้ายังจำแอปที่เขียนให้โพสหน้าวอลได้ ให้ดึง<a href="https://gist.github.com/pureexe/ca13f57332aa46bf47e9">โค้ดนั้น</a>มาเลยครับ<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-7-O2QbCwN8U/VA4u49kWZfI/AAAAAAAARJY/STjPo4RbmI0/s1600/graph-01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-7-O2QbCwN8U/VA4u49kWZfI/AAAAAAAARJY/STjPo4RbmI0/s1600/graph-01.png" height="257" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;">แต่เนื่องจากโค้ดนั้นผมยังเขียนอย่างลวกๆ มาเขียนกันต่ออีกสักนิดนะครับเพื่อให้ดูสมบูรณ์ยิ่งขึ้น</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-3woHVEXMQA4/VA4znTFTNjI/AAAAAAAARJo/tqbixBFteZ0/s1600/persmission2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-3woHVEXMQA4/VA4znTFTNjI/AAAAAAAARJo/tqbixBFteZ0/s1600/persmission2.png" height="320" width="263" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;">สามารถดูโค้ดเต็มได้<a href="https://gist.github.com/pureexe/271f012b1b8aa91fc7c0">ที่นี่</a>&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;">มาอธิบายโค้ดกันหน่อยดีกว่าครับ ก่อนอื่นเลยที่บรรทัด 44 จะเห็นคำว่า read_stream ครับ นั่นคือ สิทธิที่เราขอเข้าถึงข้อมูลจาก เฟสบุ๊คนะครับ ว่าเราขอสิทธิเข้าถึงหน้าวอล ถ้าอยากรู้ว่ามีสิทธิ์อะไรให้ขอบ้างเข้าไปดูที่ <a href="https://developers.facebook.com/tools/explorer/">Graph Explorer</a> ครับ</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-cCgQZEFP8eo/VAuzf4cNR0I/AAAAAAAAQ8Q/jcEmoh0ylOg/s1600/api-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-cCgQZEFP8eo/VAuzf4cNR0I/AAAAAAAAQ8Q/jcEmoh0ylOg/s1600/api-2.png" height="178" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;">(ภาพ ตัวอย่างสิทธิที่สามารถเข้าถึงได้สามารดูได้จาก&nbsp;<a href="https://developers.facebook.com/tools/explorer/">Graph Explorer</a>&nbsp;)<br /><br />หลังจากนั้นผมได้เพิ่มโค้ดส่วนของ&nbsp;FB.getLoginStatus ใน FB.login นะครับเพื่อตรวจสอบว่าเรา login แล้วรึยัง หาก login แล้ว ให้ refresh หน้าครับ เพื่อให้แอปเรารันโค้ดที่ตรวจสอบการ login ในบรรทัดที่ 9 ครับ</div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-jqF-6X1OEqQ/VA41V3qJaFI/AAAAAAAARJ0/JNGy78P-c9c/s1600/persmission3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-jqF-6X1OEqQ/VA41V3qJaFI/AAAAAAAARJ0/JNGy78P-c9c/s1600/persmission3.png" height="161" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;">เมื่อมาถึงบรรทัดที่ 9 จะเห็นว่ามีการเรียก FB.api โดยเรียกกราฟ ไปยัง ขอบ persmission เพื่อดูว่าตอนนี้ คนใช้ให้สิทธิอะไรแก่แอปบ้าง แล้วก็ตรวจสอบว่ามีสิทธิที่เราต้องการครบหรือไม่ หาก ครบ ให้รันหน้าแอปต่อไป แต่ถ้าไม่ ให้ขึ้นหน้า login ใหม่ ที่ผมทำแบบนี้เพื่อป้องกันผู้ใช้ login มาจากแอปอื่น ที่อยู่ในบล็อกเดียวกันเพราะจะทำให้แอปของเราเอ๋อเนื่องจาก เรียกข้อมูลไปแต่โดนปฏิเสธ<br /><br />ขอจบตอนนี้ไว้ก่อนนะครับ จริงๆผมต้องการจะสอนในส่วนให้ซ่อนแสดงหน้า login กับหน้าเรียกแอปต่อ แต่เพิ่งนึกได้ว่ายังไม่ได้สอนให้คนในบล็อกนี้ รู้จักกับการติดตั้ง library ลงบนบล็อกเลย เดี๋ยวแอปมันจะทำงานไม่ได้จึงขอพักไว้ก่อนครับ</div><div class="separator" style="clear: both; text-align: center;"><br /></div><br />